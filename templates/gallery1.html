<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gallery â€” Iffat</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }

    body {
      background:#111;
      color:#fff;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    header {
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#1a1a1a;
      padding:15px 25px;
      box-shadow:0 0 10px #e22453;
      position:sticky;
      top:0;
      z-index:10;
    }

    header h2 { color:#cf1f54; }

    nav {
      display:flex;
      align-items:center;
      gap:10px;
    }

    nav a, nav button {
      text-decoration:none;
      color:#fff;
      background:#d62a55;
      padding:6px 14px;
      border-radius:20px;
      transition:0.3s;
      border:none;
      cursor:pointer;
      font-size:15px;
    }

    nav a:hover, nav button:hover { background:#ba2554; }

    main {
      flex:1;
      width:100%;
      display:flex;
      justify-content:center;
      overflow-y:auto;
      padding:10px;
      scroll-behavior:smooth;
      height: calc(100vh - 80px);
    }

    .gallery-container {
      display:flex;
      flex-direction:column;
      gap:30px;
      align-items:center;
      max-height:80vh;
    }

    .gallery-item {
      display:flex;
      flex-direction:column;
      align-items:center;
      background:#222;
      padding:15px;
      border-radius:12px;
      box-shadow:0 0 15px #c20d3a;
      position:relative;
    }

    .gallery-item img,
    .gallery-item video {
      max-width:90vw;
      max-height:70vh;
      object-fit:contain;
      border-radius:12px;
      display:block;
    }

    .text-content {
      margin-top:10px;
      color:#ca355a;
      text-align:center;
      word-wrap:break-word;
    }

    .checkbox {
      position:absolute;
      top:10px;
      left:10px;
      transform:scale(1.3);
      cursor:pointer;
    }

    @media (max-width:600px) {
      .gallery-item { font-size:0.9rem; }
    }
  </style>
</head>
<body>

<header>
  <h2>ðŸ’–</h2>
  <nav>
    <a href="/home">Home</a>
    <a href="/logout">Logout</a>
    <button type="button" onclick="submitDelete()">Delete Selected</button>
  </nav>
</header>

<!-- âœ… Moved form here -->
<main id="galleryMain">
  <form method="POST" action="/delete" id="deleteForm">
    <div class="gallery-container">
      {% for file in files %}
      <div class="gallery-item">
        <input type="checkbox" class="checkbox" name="delete_ids" value="{{ file.id }}">
        {% if file.file_type == 'image' %}
         <img src="{{ file.file_path }}" alt="Memory">

        {% elif file.file_type == 'video' %}
         <video src="{{ file.file_path }}" controls></video>

        {% endif %}
        <div class="text-content">{{ file.text_content }}</div>
      </div>
      {% endfor %}
    </div>
  </form>
</main>

<script>
  // Ensure header height is considered and main gets a fixed height for scrolling
  const header = document.querySelector('header');
  const main = document.getElementById('galleryMain');
  const deleteForm = document.getElementById('deleteForm');

  function updateMainHeight() {
    // space for header (use offsetHeight) + small padding
    const headerH = header ? header.offsetHeight : 0;
    // subtract from viewport height so main can scroll
    main.style.height = `calc(100vh - ${headerH}px - 10px)`;
    main.style.overflowY = 'auto';
  }

  // initial setup
  updateMainHeight();

  // recalc on resize (mobile rotate etc)
  window.addEventListener('resize', updateMainHeight);

  // Auto-scroll variables
  let autoScroll = true;
  // pixels per second (makes it easier to tune)
  let speedPPS = 40; // 40 px per second; lower = slower
  let lastTime = null;

  // only auto-scroll if content overflows
  function canScroll() {
    return main.scrollHeight > main.clientHeight + 1; // +1 tolerance
  }

  function autoScrollFrame(timestamp) {
    try {
      if (!lastTime) lastTime = timestamp;
      const delta = (timestamp - lastTime) / 1000; // seconds since last frame
      lastTime = timestamp;

      if (autoScroll && canScroll()) {
        // amount to scroll in this frame
        const move = speedPPS * delta;
        main.scrollTop += move;

        // if reached bottom, loop back to top smoothly
        if (main.scrollTop + main.clientHeight >= main.scrollHeight - 1) {
          // small timeout so user can see last image before jump
          setTimeout(() => { main.scrollTop = 0; }, 300);
        }
      }
    } catch (err) {
      console.error('Auto-scroll error:', err);
    }

    requestAnimationFrame(autoScrollFrame);
  }

  requestAnimationFrame(autoScrollFrame);

  // Pause auto-scroll while user manually scrolls (and resume)
  let manualScrollTimeout = null;
  main.addEventListener('wheel', () => {
    autoScroll = false;
    clearTimeout(manualScrollTimeout);
    manualScrollTimeout = setTimeout(() => { autoScroll = true; }, 1000);
  }, { passive: true });

  // also watch touch-events for mobile
  main.addEventListener('touchstart', () => {
    autoScroll = false;
    clearTimeout(manualScrollTimeout);
  }, { passive: true });
  main.addEventListener('touchend', () => {
    clearTimeout(manualScrollTimeout);
    manualScrollTimeout = setTimeout(() => { autoScroll = true; }, 2000);
  }, { passive: true });

  // helpful console info for debugging
  console.log('Auto-scroll initialized. canScroll=', canScroll());

  // expose a small helper to toggle / change speed from console if needed:
  window.galleryAutoScroll = {
    setSpeed(pxPerSec) { speedPPS = Number(pxPerSec) || speedPPS; console.log('speed set to', speedPPS); },
    pause() { autoScroll = false; console.log('auto-scroll paused'); },
    resume() { autoScroll = true; console.log('auto-scroll resumed'); },
    status() { console.log({ autoScroll, speedPPS, canScroll: canScroll() }); }
  };

  // If you used a header 'Delete' button that calls submitDelete(), keep this:
  function submitDelete() {
    if (deleteForm) deleteForm.submit();
  }
  window.submitDelete = submitDelete;
</script>


</body>
</html>
